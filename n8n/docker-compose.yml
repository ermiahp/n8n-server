services:
  n8n:
    image: n8nio/n8n:latest
    container_name: n8n
    restart: unless-stopped
    
    ports:
      - "5678:5678"
    
    environment:
      # Generic timezone support
      - GENERIC_TIMEZONE=${N8N_GENERIC_TIMEZONE:-UTC}
      - TZ=${N8N_TZ:-UTC}
      
      # N8N basic configuration
      - N8N_HOST=${N8N_HOST:-localhost}
      - N8N_PORT=5678
      - N8N_PROTOCOL=${N8N_PROTOCOL:-http}
      
      # Webhook configuration - this is the external URL where webhooks will be accessible
      - WEBHOOK_URL=${N8N_WEBHOOK_URL:-http://localhost:5678/}
      
      # Database configuration (uses SQLite by default)
      # Uncomment and configure if you want to use PostgreSQL or MySQL
      # - DB_TYPE=postgresdb
      # - DB_POSTGRESDB_HOST=postgres
      # - DB_POSTGRESDB_PORT=5432
      # - DB_POSTGRESDB_DATABASE=${N8N_DB_NAME:-n8n}
      # - DB_POSTGRESDB_USER=${N8N_DB_USER:-n8n}
      # - DB_POSTGRESDB_PASSWORD=${N8N_DB_PASSWORD}
      
      # Execution settings
      - EXECUTIONS_PROCESS=${N8N_EXECUTIONS_PROCESS:-main}
      - EXECUTIONS_MODE=${N8N_EXECUTIONS_MODE:-regular}
      
      # Basic auth (optional - uncomment to enable)
      # - N8N_BASIC_AUTH_ACTIVE=true
      # - N8N_BASIC_AUTH_USER=${N8N_BASIC_AUTH_USER}
      # - N8N_BASIC_AUTH_PASSWORD=${N8N_BASIC_AUTH_PASSWORD}
      
      # Encryption key for credentials (IMPORTANT: Set this to a random string)
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-change-this-to-a-random-string}
    
    volumes:
      - n8n_data:/home/node/.n8n
      # Uncomment to mount local files for workflows backup
      # - ./workflows:/home/node/.n8n/workflows
      # Mount for file storage - allows Read/Write File node to work with local files
      - ./files:/files
    
    # Note: The ./files directory must exist on the host and be writable
    # Run this on the host before starting: mkdir -p ./files && chmod 777 ./files
    # Or set ownership to match container user: chown -R 1000:1000 ./files
    
    networks:
      - n8n_network

volumes:
  n8n_data:
    name: n8n_data

networks:
  n8n_network:
    name: n8n_network
    driver: bridge
